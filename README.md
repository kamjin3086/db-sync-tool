

# MySQL 增量结构同步工具 Readme

本项目是一个基于 Python 和 Tkinter 开发的图形化桌面工具，旨在解决在两个网络不通的 MySQL 数据库之间，安全地进行**增量结构同步**的问题。

它能够比对源数据库的结构（来自SQL文件）和目标数据库的当前结构，并自动生成一个**只包含新增表和新增字段**的安全SQL脚本，确保目标数据库的现有数据和结构**不会被删除或覆盖**。

## ✨ 主要功能

*   **图形化界面 (GUI)**：操作直观，无需编写任何代码。
*   **增量同步**：只添加不存在的表和字段，不执行任何 `DROP` 或危险的 `ALTER` 操作。
*   **安全可控**：生成的SQL脚本会先在界面上显示，供用户在执行前进行最终审核。
*   **配置缓存**：自动保存上次使用的配置，下次打开时无需重新填写。
*   **离线操作**：完美支持源服务器A和目标服务器B无法直接通信的场景。
*   **跨平台运行**：Python脚本可在多平台运行，并已提供Windows下的打包方案。

---

## 🚀 如何使用 (面向使用者)

如果您拿到了打包好的 `MySQL_DB_Sync.exe` 文件，请按照以下步骤操作。

### 步骤 1：准备工作 - 从Navicat导出源数据库结构

这是整个流程的起点。您需要从源服务器A的数据库中导出一个**纯结构**的SQL文件。

1.  在 Navicat 中，右键点击源数据库（例如 `mydb`）。
2.  选择 **转储SQL文件 (Dump SQL File) -> 仅结构 (Structure Only)**。
3.  在弹出的窗口中，确保所有需要同步的表都被勾选。
4.  点击“开始”，将文件保存到您的电脑上，例如 `mydb.sql`。

> **⚠️ 重要提示：**
> 直接执行这个从Navicat导出的SQL文件是非常危险的，因为它包含了 `DROP TABLE IF EXISTS ...` 语句，这会**删除您目标数据库的同名表和所有数据**！本工具的核心价值就是为了避免这种风险。

### 步骤 2：运行同步工具

1.  双击运行 `MySQL_DB_Sync.exe`。

2.  在工具界面中，依次填写信息：
    *   **1. 选择源结构SQL文件**：点击 **“浏览...”** 按钮，选择您刚刚从Navicat导出的 `source_schema.sql` 文件。
    *   **2. 配置目标数据库连接**：准确填写您要同步到的目标数据库（服务器B）的连接信息，包括主机IP、端口、用户名、密码和数据库名。

3.  点击 **“3. 对比并生成增量SQL”** 按钮。
    *   程序会开始分析SQL文件并连接目标数据库进行比对。状态栏会显示当前进度。
    *   比对完成后，一个安全的增量SQL脚本会显示在下方的文本框中。

4.  **审核生成的脚本 (关键步骤！)**
    *   仔细检查文本框中生成的SQL脚本，确认其中只包含 `CREATE TABLE ...` (新增表) 和 `ALTER TABLE ... ADD COLUMN ...` (新增字段) 语句。

5.  **执行同步**
    *   **方式一 (推荐)**：点击 **“复制脚本”** 按钮，然后将脚本粘贴到您信任的数据库管理工具（如Navicat, DBeaver）中手动执行。这提供了一次最终的检查机会。
    *   **方式二 (便捷)**：确认脚本无误后，点击 **“4. 在目标库执行SQL”** 按钮。程序会弹出警告框，确认后将自动在目标数据库上执行该脚本。

6.  **完成！** 您的目标数据库现在已经拥有了所有新增的表和字段，且原有数据完好无损。下次再打开此工具时，您填写的配置信息会自动加载。

---

## 🛠️ 如何打包 (面向开发者)

如果您需要修改源代码，或者想在自己的环境中重新打包生成 `.exe` 文件，请遵循以下步骤。

### 环境准备

1.  确保您的电脑上已安装 Python (推荐 3.8 或更高版本)。
2.  打开命令行工具 (CMD 或 PowerShell)，安装所有必要的库：
    ```bash
    pip install nuitka zstandard pymysql sqlparse
    ```

### 文件结构

请确保您的项目文件夹包含以下文件：

```
your-project-folder/
|
|-- db_sync_tool.py         # Python主程序脚本
|-- build.bat               # 打包脚本
|-- app_icon.ico            # (可选) 程序的图标文件
|-- README.md               # 本说明文件
```

### 打包步骤

1.  将上述所有文件放在同一个文件夹中。
2.  **双击运行 `build.bat` 脚本**。
3.  一个命令行窗口将会出现，并开始执行Nuitka打包命令。
    *   **首次运行**：Nuitka可能会提示下载并安装C语言编译器，这需要一些时间，请耐心等待并按提示操作。
    *   后续运行会因为利用了缓存而快得多。
4.  打包成功后，脚本会自动打开一个名为 `dist` 的新文件夹。
5.  在 `dist` 文件夹中，您会找到最终生成的可执行文件 `MySQL_DB_Sync.exe`。


## ⚠️ 重要注意事项

1.  **永远先备份**：在对生产数据库进行任何结构变更之前，请务必、务必、务必创建一个完整的数据库备份！
2.  **先在测试环境演练**：在同步到生产数据库之前，强烈建议先在结构相似的测试数据库上完整地操作一遍，确保一切符合预期。
3.  **数据库权限**：请确保您在工具中使用的数据库用户拥有在目标数据库上执行 `CREATE TABLE` 和 `ALTER TABLE` 的权限。